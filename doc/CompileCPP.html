<html>
<head>
<title>Syzygy: Compiling C++ Programs</title>
</head>
<body bgcolor="#ffffff">
<a href="index.html">Documentation Index</a>

<p><font size=+2>Syzygy: Compiling C++ Programs</font>

<p>There are five environment variables that control the build process.
If you are using a precompiled SDK, one of them, SZG_DEVELOPER_STYLE, must
be set. THIS IS VERY IMPORTANT.

<p>PLEASE NOTE: if you are using Visual Studio 6 on Windows, you MUST compile
with STLport (SZG_STLPORT=TRUE). Using STLport is described 
<a href="SupportingLibraries.html">here</a>. On the other hand, DO NOT use
STLport with Visual Studio .NET (its native standard template library is OK).

<p><ol>
<li>SZGHOME: The top level directory of your distribution. This MUST
  be defined.
<li>SZG_DEVELOPER_STYLE: By default, the system assumes you are using
  software compiled by you from a szg source distribution. To use a precompiled
  SDK, this must be set to EASY.
<li>SZGBIN: 
  <ol>
  <li>If $SZGBIN is defined, then this is used as the directory for Syzygy
    executables and shared libraries that you compile. 
  <li>If $SZGBIN is not defined, there are two possibilities, depending upon
    whether or not the developer style is "EASY".
    <ul>
    <li>If SZG_DEVELOPER_STYLE=EASY, then your executables and shared libraries
        will be placed in $(SZGHOME)/bin. 
    <li>Otherwise, you are assumed to have a "developer" version of Syzygy
        and your executables will be placed in $(SZGHOME)/bin/$(MACHINE_DIR),
        where $(MACHINE_DIR) is one of darwin, linux, mips4, or win32.
    </ul>
  </ol>
<li>SZGEXTERNAL: The location of any external libraries used. 
  This MUST be defined if your system does not have GLUT preinstalled. 
  Otherwise, it is optional. 
  See this <a href="SupportingLibraries.html">section</a>. Please note
  that a complete "external" directory is provided for each supported
  platform as part of the SDK.
<li>SZGDEBUG: By default, executables and shared libraries are built without
  debugging information. If you want to debug, set this to TRUE.
</ol>

<p>PLEASE NOTE: If you are using the precompiled SDK for Windows, you must
use the same SDK as your compiler (-vc6 for Visual Studio 6 and -vc7 for
Visual Studio .NET). If you mix versions, your executables either will
not link or will crash on startup.

<p>Syzygy has a build system designed for writing cross-platform applications,
hiding the differences from the programmer. A motivating example of
its design is: if your build directory is simultaneously mounted on different 
platforms, you can compile both versions of your code at once. The build
system can be leveraged for your own applications and a template is contained
in szg_app_template-X.X.tar.gz, which is available with the rest of the 
Syzygy software.

<p>After obtaining the template, unpack it to a directory szg_app_template. If
desired, you can rename it, though we continue using the generic name below
for simplicity. If your each file of your source code produces an 
executable, you can create your Syzygy project by simply modifying one
line (ALL) and then creating a target for each executable, as outlined below.
It is also simple to, for instance, modify the Makefile template to produce
executables from multiple .cpp files (using the OBJS line). 

<p>Once you have modified szg_app_template to create your project, you can
build it by typing "make" in the top-level directory or clean it, removing
built executables and objects, by typing "make clean" in the same location.
All built executables (defined by ALL below) will be copied into your
Syzygy executables directory. This is determined like so:

<p>PLEASE NOTE: if you are compiling using cygwin on Windows then there can 
be a problem. The Visual Studio linker is called "link" and some installs of
cygwin mayn also install a "link" program. If, during your build, you see
an error message like:

<pre>
  link error: too many arguments
</pre>

You will know you are getting the cygwin "link" program by mistake. You can
solve this problem by typing "which link", seeing where the cygwin "link"
resides, and removing it, or you can make sure your $PATH environment
variable has the Visual Studio program in it first (as explained
<a href="VisualStudioBuildVars.html">here</a>).

<p>With that warning given, we now examine the contents of szg_app_template, 
explaining each one.

<p><ul>
<li>szg_app_template/Makefile: The overall Makefile for the template project.
Scans the host to determine the platform and then executes the appropriate
machine-specific Makefile.
<li>szg_app_template/src: Your source code goes here, after removing the
sample piece of source code, szglorenz.cpp.
<li>szg_app_template/build/makefiles/Makefile.my_app: This is the fill you will
edit to create your project. Its important features are explained below as
well as via comments in the file itself.
<li>szg_app_template/build/darwin: The Mac OS X-specific Makefile is located
here and OS X objects are built here. The machine-specific Makefile really just
sets the machine type and then includes Makefile.my_app, the cross-platform
piece.
<li>szg_app_template/build/linux: The Linux objects are built here.
<li>szg_app_template/build/mips4: The SGI objects are built here.
<li>szg_app_template/build/win32: The Windows objects are built here.
</ul>

<p>By now, you have placed your source code in szg_app_template/src. The
functional lines in Makefile.my_app, along with how to edit them will now be 
explained.

<pre>
  VPATH=../../src
</pre>

<p>This should not be changed. It gives the relative path from each
machine-specific Makefile, like szg_app_template/build/linux/Makefile,
to your source directory.

<pre>
  include $(SZGHOME)/build/make/Makefile.vars
</pre>

<p>This should not be changed. The Syzygy SDK has a file, Makefile.vars,
that defines the specific compilation and linking methods for each platform
in a modular fashion. This line is one reason you must define $SZGHOME to
use the Syzygy SDK.

<pre>
  ALL := szglorenz$(EXE)
</pre> 

<p>Here, you should replace szglorenz$(EXE) with a list of executables
you want built. For cross-platform builds to work, each name must end in
$(EXE), which accounts for the fact that Windows executables must have the
postfix .EXE whereas Unix executables do not.

<pre>
  include $(SZGHOME)/build/make/Makefile.rules
</pre>

<p>This should not be changed. The Syzygy SDK has a file, Makefile.rules,
that defines the various standard rules, like "clean" or "create-install",
which should be in every project. This file is seperated from Makefile.vars
to create flexibility: make is particular about the order in which rules
appear.

<pre>
  OBJS := 
</pre>

<p>If your executable uses code contained in files my_obj_1.cpp and 
my_obj_2.cpp, you'll need to edit this line. Do not forget the $(OBJ_SUFFIX)
ending, since this accounts for the different object file endings on Windows
(.obj) and Unix (.o). There is a make rule in Makefile.rules that governs
converting .cpp files into object files.

<pre>
  OBJS := my_obj_1$(OBJ_SUFFIX) my_obj_2$(OBJ_SUFFIX)
</pre>

<p>If your project needs additional compile flags, you can include them like
so:

<pre>
  COMPILE_FLAGS += -DMY_COMPILE_FLAG1 -DMY_COMPILE_FLAG2
</pre>

<p>If your project needs additional include directories, you can add them like
so:

<pre>
  SZG_INCLUDE += -I$(MY_INCLUDE_DIRECTORY1)
</pre>

<p>If your project needs additional libraries, you can add them like so:

<pre>
  SZG_OPTIONAL_LIBS += $(MY_NEW_LIBRARY)
</pre>

<p>Finally, you'll need a target for each of your executables. If your
executables, as listed above in ALL, have names my_exe_1$(EXE) and
my_exe_2$(EXE) and they link with the OBJS you've defined above, then the
targets will look like:

<pre>
  my_exe_1$(EXE): my_exe_1$(OBJ_SUFFIX) $(OBJS) $(SZG_LIBRARY_DEPS)
        $(SZG_USR_FIRST) my_exe_1$(OBJ_SUFFIX) $(OBJS) $(SZG_USR_SECOND)
        $(COPY)

  my_exe_2$(EXE): my_exe_2$(OBJ_SUFFIX) $(OBJS) $(SZG_LIBRARY_DEPS)
        $(SZG_USR_FIRST) my_exe_2$(OBJ_SUFFIX) $(OBJS) $(SZG_USR_SECOND)
        $(COPY)

</pre>

<p>The variable $(SZG_USR_FIRST) contains the linker name, linker options
and link libraries, if the platform is Windows. If the platform is Unix-based,
it does not contain the link libraries, which instead appear in 
$(SZG_USR_SECOND), which is blank in the Windows case.
The $(COPY) line copies the built executable into your $SZGBIN directory
where all of your Syzygy-related executables are stored.

</body>
</html>
