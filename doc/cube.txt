<szg_config>

<param>
<name> cube_joystick </name>
<value>
  <szg_device>
    <input_sources> arJoystickDriver </input_sources>
    <input_sinks></input_sinks>
    <input_filters></input_filters>
    <pforth>
	define filter_axis_0
	    getCurrentEventAxis 0.000031 * setCurrentEventAxis
	enddef
	define filter_axis_1
	  getCurrentEventAxis -0.000031 * setCurrentEventAxis
	enddef
    </pforth>
  </szg_device>
</value>
</param>

<param>
<name> reaction_timer </name>
<value>
  <szg_device>
    <input_sources> arReactionTimerDriver </input_sources>
    <input_sinks></input_sinks>
    <input_filters></input_filters>
    <pforth></pforth>
  </szg_device>
</value>
</param>

<param>
<name> cube_tracker </name>
<value>
  <szg_device>
    <input_sources> arMotionstarDriver </input_sources>
    <pforth>
        initTrackerCalibration
        initIIRFilter

        /* Define stuff to rotate & remap positional coordinates and rotate orientation by 135 degrees around Y */
        matrix yTransRotMatrix
        -45. yaxis yTransRotMatrix rotationMatrix

        vector oldLo
        vector oldHi
        vector newLo
        vector newHi
        1.2 -5. 1.2  oldLo vectorStore
        10.4 5. 10.4 oldHi vectorStore
        -5.  0. -5.  newLo vectorStore
        5.   10. 5.  newHi vectorStore

        vector oldRange
        vector newRange
        oldHi oldLo 3 oldRange arraySubtract
        newHi newLo 3 newRange arraySubtract

        vector newOldRatio
        newRange oldRange 3 newOldRatio arrayDivide

        vector position

        define rescale_position
          position oldLo 3 position arraySubtract
          position newOldRatio 3 position arrayMultiply
          position newLo 3 position arrayAdd
        enddef

        matrix yRotMatrix
        -135 yaxis yRotMatrix rotationMatrix

	matrix inputMatrix
        matrix rotMatrix
        matrix transMatrix

        /* Apply transformations that are common to all sensors */
        define filter_all_matrices
	  inputMatrix getCurrentEventMatrix

          /* Extract translation, rotate it by 45 degrees about y */
          inputMatrix position extractTranslation
          yTransRotMatrix position position vectorTransform

          /* Rescale position coords */
          rescale_position

          /* Rotate rotation component about Y */
          inputMatrix rotMatrix extractRotationMatrix
          yRotMatrix rotMatrix rotMatrix matrixMultiply

          /* Recombine translational and rotational components */
          position transMatrix translationMatrixV
          transMatrix rotMatrix inputMatrix matrixMultiply

          /* Apply tracker-calibration lookup table */
          inputMatrix inputMatrix doTrackerCalibration

	  inputMatrix setCurrentEventMatrix
        enddef

        /* Fix rotational matrix components (depends on how sensors are mounted) */
	matrix headZRotMatrix
	matrix wandZRotMatrix
        matrix wandTweakMatrix

        /* Head sensor is mounted sideways */
	-90 zaxis headZRotMatrix rotationMatrix

        /* Wand sensor is mounted upside-down */
	-180 zaxis wandZRotMatrix rotationMatrix

        /* Wand sensor points upwards by about 20 degrees with gamepad held
           subjectively level (actually tilted up slightly, but it feels right) */
        -20. xaxis wandTweakMatrix rotationMatrix

        matrix wandRotMatrix
        wandZRotMatrix wandTweakMatrix wandRotMatrix matrixMultiply

        /* Head-specific filter (applied after generic, above) */
	define filter_matrix_0
	  inputMatrix getCurrentEventMatrix
          inputMatrix inputMatrix doIIRFilter
	  inputMatrix headZRotMatrix inputMatrix matrixMultiply
	  inputMatrix setCurrentEventMatrix
	enddef

        /* Hand-specific filter (applied after generic) */
	define filter_matrix_1
	  inputMatrix getCurrentEventMatrix
	  inputMatrix wandRotMatrix inputMatrix matrixMultiply
	  inputMatrix setCurrentEventMatrix
	enddef

    </pforth>
  </szg_device>
</value>
</param>


<comment>
PLEASE NOTE: inputsimulator is a HACK so far. And is treated differently than
everything else. In particular, it has no szg_device record as in the above!
</comment>

<comment>
 The configuration of the cube has two parts, one which varies from user to
 user and only consists of the path upon which the system should search for
 executables... and another part which configures the system. This
 second part is further subdivided into "everything else" and "graphics"
 configuartion that varies per user (really just varies based on linux
 or windows).
</comment>

<comment> 
Exec paths: replace THE_USER_NAME with your login name. 
NOTE: The computers that may need to run a python executable must have
python in the EXEC_PATH!
NOTE: Some of the applications need to be compiled seperately. For instance,
vtkfile needs Visual Studio 7, so it is compiled by a certain user (schaeffr)
The "zillimath" demos are also compiled by a particular user (gfrancis)
</comment>

<assign>
picasso  SZG_EXEC path G:\THE_USER_NAME\bin\win32 
joystick SZG_EXEC path G:\THE_USER_NAME\bin\win32
air      SZG_EXEC path /home/public/THE_USER_NAME/bin/linux;/usr/bin
north    SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
south    SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
east     SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
west     SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
top      SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
bottom   SZG_EXEC path G:\THE_USER_NAME\bin\win32;g:\Python22;g:\schaeffr\bin-stable\win32;g:\gfrancis\bin-stable\win32
</assign>

<comment> Path for python applications. Note that
          picasso only needs the python path for
          locating bundled data (sounds), it won't
          be running any python apps. </comment>
<assign>
air      SZG_PYTHON path /home/public/pycube
north    SZG_PYTHON path G:\pycube
south    SZG_PYTHON path G:\pycube
east     SZG_PYTHON path G:\pycube
west     SZG_PYTHON path G:\pycube
top      SZG_PYTHON path G:\pycube
bottom   SZG_PYTHON path G:\pycube
fire     SZG_PYTHON path G:\pycube
picasso  SZG_PYTHON path G:\pycube
</assign>

<comment> Path for python modules. Note that the application directory, the
          SZG_PYTHON/path directory, and the PYTHONPATH on each machine
          will also be searched.
</comment>
<assign>
air      SZG_PYTHON lib_path NULL
north    SZG_PYTHON lib_path NULL
south    SZG_PYTHON lib_path NULL
east     SZG_PYTHON lib_path NULL
west     SZG_PYTHON lib_path NULL
top      SZG_PYTHON lib_path NULL
bottom   SZG_PYTHON lib_path NULL
fire     SZG_PYTHON lib_path NULL
</assign>

<comment>
 Configuration that is basically the same for all users
 everything besides graphics goes first.
</comment>

<comment> definitions of the cube virtual computers </comment>

<comment> The "standard" virtual computer (trigger on air). </comment>
<assign>
cube SZG_CONF    location       cube
cube SZG_CONF    virtual        true
cube SZG_TRIGGER map            air
cube SZG_MASTER  map            SZG_SCREEN2
cube SZG_SCREEN  number_screens 6
cube SZG_SCREEN0 map            top/SZG_SCREEN0
cube SZG_SCREEN0 networks       cube/internet
cube SZG_SCREEN1 map            bottom/SZG_SCREEN0
cube SZG_SCREEN1 networks       cube/internet
cube SZG_SCREEN2 map            north/SZG_SCREEN0
cube SZG_SCREEN2 networks       cube/internet
cube SZG_SCREEN3 map            south/SZG_SCREEN0
cube SZG_SCREEN3 networks       cube/internet
cube SZG_SCREEN4 map            east/SZG_SCREEN0
cube SZG_SCREEN4 networks       cube/internet
cube SZG_SCREEN5 map            west/SZG_SCREEN0
cube SZG_SCREEN5 networks       cube/internet
cube SZG_INPUT0  map            air/cube_tracker/joystick/cube_joystick
cube SZG_INPUT0  networks       internet
cube SZG_SOUND   map            picasso
cube SZG_SOUND   networks       internet
</assign>

<comment> Windows-only V.C., trigger on north </comment>
<assign>
wincube SZG_CONF    location       cube
wincube SZG_CONF    virtual        true
wincube SZG_TRIGGER map            north
wincube SZG_MASTER  map            SZG_SCREEN2
wincube SZG_SCREEN  number_screens 6
wincube SZG_SCREEN0 map            top/SZG_SCREEN0
wincube SZG_SCREEN0 networks       cube/internet
wincube SZG_SCREEN1 map            bottom/SZG_SCREEN0
wincube SZG_SCREEN1 networks       cube/internet
wincube SZG_SCREEN2 map            north/SZG_SCREEN0
wincube SZG_SCREEN2 networks       cube/internet
wincube SZG_SCREEN3 map            south/SZG_SCREEN0
wincube SZG_SCREEN3 networks       cube/internet
wincube SZG_SCREEN4 map            east/SZG_SCREEN0
wincube SZG_SCREEN4 networks       cube/internet
wincube SZG_SCREEN5 map            west/SZG_SCREEN0
wincube SZG_SCREEN5 networks       cube/internet
wincube SZG_INPUT0  map            air/cube_tracker/joystick/cube_joystick
wincube SZG_INPUT0  networks       internet
wincube SZG_SOUND   map            picasso
wincube SZG_SOUND   networks       internet
</assign>

<comment> V.C. for many experiments: Windows-only,
          trigger on north, with a copy also running
          on fire.
</comment>
<assign>
expt_cube SZG_CONF    location       cube
expt_cube SZG_CONF    virtual        true
expt_cube SZG_TRIGGER map            north
expt_cube SZG_MASTER  map            SZG_SCREEN2
expt_cube SZG_SCREEN  number_screens 7
expt_cube SZG_SCREEN0 map            top/SZG_SCREEN0
expt_cube SZG_SCREEN0 networks       cube/internet
expt_cube SZG_SCREEN1 map            bottom/SZG_SCREEN0
expt_cube SZG_SCREEN1 networks       cube/internet
expt_cube SZG_SCREEN2 map            north/SZG_SCREEN0
expt_cube SZG_SCREEN2 networks       cube/internet
expt_cube SZG_SCREEN3 map            south/SZG_SCREEN0
expt_cube SZG_SCREEN3 networks       cube/internet
expt_cube SZG_SCREEN4 map            east/SZG_SCREEN0
expt_cube SZG_SCREEN4 networks       cube/internet
expt_cube SZG_SCREEN5 map            west/SZG_SCREEN0
expt_cube SZG_SCREEN5 networks       cube/internet
expt_cube SZG_SCREEN6 map            fire/SZG_SCREEN0
expt_cube SZG_SCREEN6 networks       internet
expt_cube SZG_INPUT0  map            air/expt_cube_tracker/joystick/cube_joystick
expt_cube SZG_INPUT0  networks       internet
expt_cube SZG_SOUND   map            picasso
expt_cube SZG_SOUND   networks       internet
</assign>

<comment> V.C. for reaction-time experiments: Windows-only,
          trigger on north, with a copy also running
          on fire, using reaction-timer instead of normal joystick.
</comment>
<assign>
rt_expt_cube SZG_CONF    location       cube
rt_expt_cube SZG_CONF    virtual        true
rt_expt_cube SZG_TRIGGER map            north
rt_expt_cube SZG_MASTER  map            SZG_SCREEN2
rt_expt_cube SZG_SCREEN  number_screens 7
rt_expt_cube SZG_SCREEN0 map            top/SZG_SCREEN0
rt_expt_cube SZG_SCREEN0 networks       cube/internet
rt_expt_cube SZG_SCREEN1 map            bottom/SZG_SCREEN0
rt_expt_cube SZG_SCREEN1 networks       cube/internet
rt_expt_cube SZG_SCREEN2 map            north/SZG_SCREEN0
rt_expt_cube SZG_SCREEN2 networks       cube/internet
rt_expt_cube SZG_SCREEN3 map            south/SZG_SCREEN0
rt_expt_cube SZG_SCREEN3 networks       cube/internet
rt_expt_cube SZG_SCREEN4 map            east/SZG_SCREEN0
rt_expt_cube SZG_SCREEN4 networks       cube/internet
rt_expt_cube SZG_SCREEN5 map            west/SZG_SCREEN0
rt_expt_cube SZG_SCREEN5 networks       cube/internet
rt_expt_cube SZG_SCREEN6 map            fire/SZG_SCREEN0
rt_expt_cube SZG_SCREEN6 networks       internet
rt_expt_cube SZG_INPUT0  map            air/expt_cube_tracker/joystick/reaction_timer
rt_expt_cube SZG_INPUT0  networks       internet
rt_expt_cube SZG_SOUND   map            picasso
rt_expt_cube SZG_SOUND   networks       internet
</assign>

<comment> Windows-only V.C., trigger on fire </comment>
<assign>
firecube SZG_CONF    virtual        true
firecube SZG_TRIGGER map            fire
firecube SZG_MASTER  map            SZG_SCREEN6
firecube SZG_SCREEN  number_screens 7
firecube SZG_SCREEN0 map            top/SZG_SCREEN0
firecube SZG_SCREEN0 networks       internet/cube
firecube SZG_SCREEN1 map            bottom/SZG_SCREEN0
firecube SZG_SCREEN1 networks       internet/cube
firecube SZG_SCREEN2 map            north/SZG_SCREEN0
firecube SZG_SCREEN2 networks       internet/cube
firecube SZG_SCREEN3 map            south/SZG_SCREEN0
firecube SZG_SCREEN3 networks       internet/cube
firecube SZG_SCREEN4 map            east/SZG_SCREEN0
firecube SZG_SCREEN4 networks       internet/cube
firecube SZG_SCREEN5 map            west/SZG_SCREEN0
firecube SZG_SCREEN5 networks       internet/cube
firecube SZG_SCREEN6 map            fire/SZG_SCREEN0
firecube SZG_SCREEN6 networks       internet
firecube SZG_INPUT0  map            air/cube_tracker/joystick/cube_joystick
firecube SZG_INPUT0  networks       internet
firecube SZG_SOUND   map            picasso
firecube SZG_SOUND   networks       internet
</assign>

<comment> fire-only V.C. </comment>
<assign>
vfire SZG_CONF    virtual        true
vfire SZG_TRIGGER map            fire
vfire SZG_MASTER  map            SZG_SCREEN0
vfire SZG_SCREEN  number_screens 1
vfire SZG_SCREEN0 map            fire/SZG_SCREEN0
vfire SZG_SCREEN0 networks       internet
vfire SZG_INPUT0  map            fire/inputsimulator
vfire SZG_INPUT0  networks       internet
vfire SZG_SOUND   map            picasso
vfire SZG_SOUND   networks       internet
</assign>

<comment>
 definitions of the various search paths that are the same from user to user
 (really just varies with OS).
</comment>

<assign>
picasso  SZG_DATA   path         g:\Data
picasso  SZG_SOUND  path         g:\Sounds
picasso  SZG_RENDER texture_path g:\Texture
picasso  SZG_RENDER text_path    g:\Texture\Text
joystick SZG_DATA   path         g:\Data
joystick SZG_SOUND  path         g:\Sounds
joystick SZG_RENDER texture_path g:\Texture
joystick SZG_RENDER text_path    g:\Texture\Text
air      SZG_DATA   path         /home/public/Data
air      SZG_SOUND  path         /home/public/Sounds
air      SZG_RENDER texture_path /home/public/Texture
air      SZG_RENDER text_path    /home/public/Texture/Text
north    SZG_DATA   path         c:\Data;g:\Data
north    SZG_SOUND  path         g:\Sounds
north    SZG_RENDER texture_path g:\Texture
north    SZG_RENDER text_path    g:\Texture\Text
south    SZG_DATA   path         c:\Data;g:\Data
south    SZG_SOUND  path         g:\Sounds
south    SZG_RENDER texture_path g:\Texture
south    SZG_RENDER text_path    g:\Texture\Text
east     SZG_DATA   path         c:\Data;g:\Data
east     SZG_SOUND  path         g:\Sounds
east     SZG_RENDER texture_path g:\Texture
east     SZG_RENDER text_path    g:\Texture\Text
west     SZG_DATA   path         c:\Data;g:\Data
west     SZG_SOUND  path         g:\Sounds
west     SZG_RENDER texture_path g:\Texture
west     SZG_RENDER text_path    g:\Texture\Text
top      SZG_DATA   path         c:\Data;g:\Data
top      SZG_SOUND  path         g:\Sounds
top      SZG_RENDER texture_path g:\Texture
top      SZG_RENDER text_path    g:\Texture\Text
bottom   SZG_DATA   path         c:\Data;g:\Data
bottom   SZG_SOUND  path         g:\Sounds
bottom   SZG_RENDER texture_path g:\Texture
bottom   SZG_RENDER text_path    g:\Texture\Text
fire     SZG_DATA   path         c:\Data;g:\Data
fire     SZG_SOUND  path         g:\Sounds
fire     SZG_RENDER texture_path g:\Texture
fire     SZG_RENDER text_path    g:\Texture\Text

</assign>

<comment> definitions of miscellaneous stuff </comment>

<assign>
air SZG_FARO       probe_radius             0.23
air SZG_FAROCAL    coord_transform          NULL
air SZG_FAROCAL    cube_width               9.86
air SZG_FAROCAL    data_file                temp.xml
air SZG_FAROCAL    data_render_scale_factor 10
air SZG_FAROCAL    filter                   arFaroCalFilter
air SZG_FAROCAL    grid_cube_size           .2
air SZG_FAROCAL    num_divisions            7
air SZG_FAROCAL    num_samples              60
air SZG_INPUT      filter                   arTrackCalFilter
air SZG_MOTIONSTAR IIR_filter_weights       0/0.9/0
air SZG_MOTIONSTAR calib_file               FaroCalLookupTables.txt
air SZG_MOTIONSTAR use_button		    false
air SZG_PFORTH     program_names            correct_tracker_rot
air SZG_TRACKER    IPhost                   130.126.127.69
</assign>

<comment> Experiment-related parameters </comment>
<assign>
north SZG_EXPT save_data false
north  SZG_EXPT file_name Demo
north SZG_EXPT method    enumerated
north SZG_EXPT subject   DEMO
north  SZG_EXPT path      G:\Experiments
south  SZG_EXPT path      G:\Experiments
east   SZG_EXPT path      G:\Experiments
west   SZG_EXPT path      G:\Experiments
top    SZG_EXPT path      G:\Experiments
bottom SZG_EXPT path      G:\Experiments
fire   SZG_EXPT path      G:\Experiments

joystick SZG_RT  com_port      1

</assign>

<comment> Head parameters (on master & controller) </comment>
<assign>

north SZG_HEAD eye_spacing 0.2
north SZG_HEAD eye_direction 1/0/0
north SZG_HEAD mid_eye_offset 0.29/0/-0.21
north SZG_HEAD fixed_head_mode false
fire SZG_HEAD eye_spacing 0.2
fire SZG_HEAD eye_direction 1/0/0
fire SZG_HEAD mid_eye_offset 0.29/0/-0.21
fire SZG_HEAD fixed_head_mode false
air SZG_HEAD eye_spacing 0.2
air SZG_HEAD eye_direction 1/0/0
air SZG_HEAD mid_eye_offset 0.29/0/-0.21
air SZG_HEAD fixed_head_mode false
</assign>

<comment> graphics configuration </comment>
<assign>

north SZG_SCREEN0 size              0/0
north SZG_SCREEN0 screen_center     0/4.93/-4.93
north SZG_SCREEN0 screen_dim        9.86/9.86
north SZG_SCREEN0 screen_normal     0/0/-1
north SZG_SCREEN0 screen_up         0/1/0
north SZG_SCREEN0 stereo            true
north SZG_SCREEN0 tile              0/1/0/1
north SZG_SCREEN0 wildcat_framelock true
north SZG_SCREEN0 head_mounted      false
north SZG_SCREEN0 fixed_head_pos    0/5.5/0
north SZG_SCREEN0 use_fixed_head_mode allow

south SZG_SCREEN0 size              0/0
south SZG_SCREEN0 screen_center     0/4.93/4.93
south SZG_SCREEN0 screen_dim        9.86/9.86
south SZG_SCREEN0 screen_normal     0/0/1
south SZG_SCREEN0 screen_up         0/1/0
south SZG_SCREEN0 stereo            true
south SZG_SCREEN0 tile              0/1/0/1
south SZG_SCREEN0 head_mounted      false
south SZG_SCREEN0 fixed_head_pos    0/5.5/0
south SZG_SCREEN0 wildcat_framelock true
south SZG_SCREEN0 use_fixed_head_mode allow

top SZG_SCREEN0 size                0/0
top SZG_SCREEN0 screen_center       0/9.86/0
top SZG_SCREEN0 screen_dim          9.86/9.86
top SZG_SCREEN0 screen_normal       0/1/0
top SZG_SCREEN0 screen_up           -1/0/0
top SZG_SCREEN0 stereo              true
top SZG_SCREEN0 tile                0/1/0/1
top SZG_SCREEN0 head_mounted      false
top SZG_SCREEN0 fixed_head_up_angle  -90
top SZG_SCREEN0 fixed_head_pos      0/5.5/0
top SZG_SCREEN0 use_fixed_head_mode allow
top SZG_SCREEN0 wildcat_framelock   true

bottom SZG_SCREEN0 size              0/0
bottom SZG_SCREEN0 screen_center     0/0/0
bottom SZG_SCREEN0 screen_dim        9.86/9.86
bottom SZG_SCREEN0 screen_normal     0/-1/0
bottom SZG_SCREEN0 screen_up         0/0/-1
bottom SZG_SCREEN0 stereo            true
bottom SZG_SCREEN0 tile              0/1/0/1
bottom SZG_SCREEN0 head_mounted      false
bottom SZG_SCREEN0 fixed_head_pos    0/5.5/0
bottom SZG_SCREEN0 use_fixed_head_mode allow
bottom SZG_SCREEN0 wildcat_framelock true

east SZG_SCREEN0 size              0/0
east SZG_SCREEN0 screen_center     4.93/4.93/0
east SZG_SCREEN0 screen_dim        9.86/9.86
east SZG_SCREEN0 screen_normal     1/0/0
east SZG_SCREEN0 screen_up         0/1/0
east SZG_SCREEN0 stereo            true
east SZG_SCREEN0 tile              0/1/0/1
east SZG_SCREEN0 head_mounted      false
east SZG_SCREEN0 fixed_head_pos    0/5.5/0
east SZG_SCREEN0 use_fixed_head_mode allow
east SZG_SCREEN0 wildcat_framelock true

west SZG_SCREEN0 size              0/0
west SZG_SCREEN0 screen_center     -4.93/4.93/0
west SZG_SCREEN0 screen_dim        9.86/9.86
west SZG_SCREEN0 screen_normal     -1/0/0
west SZG_SCREEN0 screen_up         0/1/0
west SZG_SCREEN0 stereo            true
west SZG_SCREEN0 tile              0/1/0/1
west SZG_SCREEN0 head_mounted      false
west SZG_SCREEN0 fixed_head_pos    0/5.5/0
west SZG_SCREEN0 use_fixed_head_mode allow
west SZG_SCREEN0 wildcat_framelock true

fire SZG_SCREEN0 size              400/400
fire SZG_SCREEN0 screen_center     0/0/-5
fire SZG_SCREEN0 screen_dim        10/10
fire SZG_SCREEN0 screen_normal     0/0/-1
fire SZG_SCREEN0 screen_up         0/1/0
fire SZG_SCREEN0 stereo            false
fire SZG_SCREEN0 tile              0/1/0/1
fire SZG_SCREEN0 head_mounted      true
fire SZG_SCREEN0 use_fixed_head_mode ignore
fire SZG_SCREEN0 wildcat_framelock false
fire SZG_INPUTSIM position 600/100

</assign>

</szg_config>


