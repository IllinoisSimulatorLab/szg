<html>
<head>
<title>Syzygy: Scene Graph Tutorial</title>
</head>
<body bgcolor="#ffffff">
<a href="index.html">Documentation Index</a>
<p><font size=+2>Syzygy: Scene Graph Tutorial</font>

<p>This tutorial will walk you through working with the Syzygy scene graph
from the Python prompt and introduce you to the concept of peer-to-peer
reality. To follow this tutorial, you'll need to either have 
compiled the <a href="GettingSoftware.html">szg library</a> and the Syzygy
<a href="PySZG.html">Python bindings</a> or have installed a Syzygy SDK as
appropriate for your system.

<p>This tutorial is complimentary to the <a href="SceneGraph.html">chapter</a>
describing the C++ scene graph API.

<p>There are several scene graph
examples written in Python.

<p><ul>
<li><a href="python/particle-shape.py">particle-shape</a>: A particle system
using some of the built-in shapes.
<li><a href="python/lorenz.py">lorenz</a>: A visualization of the lorenz attractor.
<li><a href="python/cosmos.py">cosmos</a>: Translation of the cosmos C++ demo into
Python.
<li><a href="python/simpleviz.py">simpleviz</a>: Shows how to manipulate a collection
of objects using a grasping tool. Also demonstrates a custom standalone mode
simulator.
</ul>

<a name="Database">
<p><font size=+2>Graphics Peers: Important Phleet Database Parameters</font>
</a>

<p>The graphics database requires a few Phleet parameters to be set for 
proper operation. For every computer upon which you want to run a display,
you should have

<pre>
  my_computer_name SZG_RENDER texture_path /the/textures/here
  my_computer_name SZG_RENDER text_path /the/text/bitmaps/here
</pre>

<p>Furthermore, it will be easier to load and save snapshots of graphics peers
if you set the SZG_PEER/path on each computer upon which you run a graphics
peer. Files will be automatically loaded and saved to this directory.

<pre>
  my_computer_name SZG_PEER path /the/peer/files/go/here
</pre>

<pre>
>>> from PySZG import *
>>> e = ezview()
>>> c = arPerspectiveCamera()
>>> c.setSides(-0.1,0.1,-0.1,0.1)
>>> c.setNearFar(0.1,100) 
>>> c.setPosition(0,5,0)
>>> c.setTarget(0,0,0)
>>> c.setUp(0,1,0)
>>> c.setPosition(0,0,5)
>>> g = arGraphicsDatabase()
>>> r = g.getRoot()
>>> light = arLight()
>>> light.lightID = 0
>>> light.position = arVector4(0,0,1,0)
>>> light.diffuse = arVector3(1,1,1)
>>> s = arSphereMesh(20)
>>> m = r.new("material")
>>> s.attachMesh(m)
>>> e.draw(g,c)
>>> l = r.new("light")
>>> l.setLight(light)
>>> e.draw(g,c)
</pre>

<p><img src="images/WhiteSphereCentered.jpg" width=400 height=421>

<pre>
>>> mat = m.get()      
>>> mat.diffuse = arVector3(1,0,0)
>>> m.set(mat)
>>> e.draw(g,c)
</pre>

<p><img src="images/RedSphereCentered.jpg" width=398 height=424>

<pre>
>>> t = g.insertNodeRef(r,m,"transform")
>>> t.set(ar_TM(0,3,0))
>>> e.draw(g,c)
>>> g.ps()
Database structure: 
(0, "root", "root")
 (7, "szg_default_7", "light")
 (8, "szg_default_8", "transform")
  (1, "szg_default_1", "material")
   (2, "sphere.points", "points")
    (3, "sphere.indices", "index")
     (4, "sphere.normal3", "normal3")
      (5, "sphere.tex2", "tex2")
       (6, "sphere.drawable", "drawable")
>>> t.set(ar_TM(0,3,0)*ar_SM(3,3,3))
>>> e.draw(g,c)
</pre>

<p><img src="images/RedSphereUp.jpg" width=398 height=423>
<p><img src="images/BigRedSphere.jpg" width=397 height=424>

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
g.setTexturePath("/Users/schaeffr/Texture")
r = g.getRoot()
light = arLight()
light.lightID = 0
light.position = arVector4(0,0,1,0)
light.diffuse = arVector3(1,1,1)
l = r.new("light")
l.set(light)
t = r.new("transform")
t.set(ar_TM(0,2,0)*ar_RM('y', ar_convertToRad(20))*ar_SM(3,3,3))
txt = t.new("texture")
txt.set("WallTexture1.ppm")
cube = arCubeMesh()
cube.attachMesh(txt)
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<p><img src="images/TexturedCube.jpg" width=401 height=425>

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
dgSetGraphicsDatabase(g)
g.setTexturePath("/Users/schaeffr/Texture")
r = g.getRoot()
light = arLight()
light.lightID = 0
light.position = arVector4(0,0,1,0)
light.diffuse = arVector3(1,1,1)
l = r.new("light")
l.set(light)
t = r.new("transform","transform_node")
t.set(ar_TM(1,1,0)*ar_RM('y', ar_convertToRad(20))*ar_SM(3,3,3))
o = arOBJ()
o.readOBJ("/Users/schaeffr/Data/OBJ/al.obj")
o.normalizeModelSize()
o.attachMesh("al", "transform_node")
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<p><img src="images/NormalAl.jpg" width=400 height=426>

<pre>
m = g.find("al.default.colors3")
mat = m.get()
mat.diffuse = arVector3(1,0,0)
m.set(mat)
</pre>

<p><img src="images/RedAl.jpg" width=400 height=425>

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
r = g.getRoot()
state = r.new("graphics state")
state.set(("point_size",20.0))
p = state.new("points")
clr = p.new("color4")
d = clr.new("drawable")
p.set([arVector3(0,0,0), 
       arVector3(1,0,0), 
       arVector3(1,1,0), 
       arVector3(0,1,0)])
clr.set([arVector4(1,0,0,1), 
	arVector4(0,1,0,1), 
	arVector4(0,0,1,1), 
	arVector4(1,1,1,1)])
d.set(("points", 4))
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<img src="images/PointsWindow.jpg">

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
r = g.getRoot()
state = r.new("graphics state")
state.set(("line_width",10.0))
p = state.new("points")
clr = p.new("color4")
i = clr.new("index")
d = i.new("drawable")
p.set([arVector3(0,0,0), 
       arVector3(1,0,0), 
       arVector3(1,1,0), 
       arVector3(0,1,0)])
clr.set([arVector4(1,0,0,1),
        arVector4(1,0,0,1), 
	arVector4(0,1,0,1),
        arVector4(0,1,0,1),
	arVector4(0,0,1,1),
        arVector4(0,0,1,1), 
	arVector4(1,1,1,1),
        arVector4(1,1,1,1),
        arVector4(1,1,0,1),
        arVector4(1,1,0,1),
        arVector4(1,1,0,1),
        arVector4(1,1,0,1)])
i.set([0,1, 1,2, 2,3, 3,0, 0,2, 1,3])
d.set(("lines", 6))
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<img src="images/LinesWindow.jpg">

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
r = g.getRoot()
state = r.new("graphics state")
state.set(("lighting", "false"))
m = state.new("material")
mat = arMaterial()
mat.diffuse = arVector3(0,1,0)
m.set(mat)
p = m.new("points")
i = p.new("index")
n = i.new("normal3")
d = n.new("drawable")
p.set([arVector3(0,0,0), 
       arVector3(3,0,0), 
       arVector3(3,3,0), 
       arVector3(0,3,0)])
n.set([arVector3(0,0,1),
       arVector3(0,0,1),
       arVector3(0,0,1)])
i.set([0,1,3])
d.set(("triangles", 1))
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<img src="images/TriangleWindow.jpg">

<pre>
from PySZG import *
import time
c = arPerspectiveCamera()
c.setSides(-0.1, 0.1, -0.1, 0.1)
c.setNearFar(0.1, 100)
c.setPosition(0, 0, 5)
c.setTarget(0, 0, 0)
c.setUp(0, 1, 0)
g = arGraphicsDatabase()
r = g.getRoot()
state = r.new("graphics state")
state.set(("lighting", "false"))
m = state.new("material")
mat = arMaterial()
mat.diffuse = arVector3(0.8,1,0.8)
m.set(mat)
texture = m.new("texture")
texture.set("WallTexture2.ppm")
p = texture.new("points")
i = p.new("index")
n = i.new("normal3")
t2 = n.new("tex2")
d = t2.new("drawable")
p.set([arVector3(0,0,0), 
       arVector3(3,0,0), 
       arVector3(3,3,0), 
       arVector3(0,3,0)])
n.set([arVector3(0,0,1),
       arVector3(0,0,1),
       arVector3(0,0,1),
       arVector3(0,0,1)])
t2.set([arVector2(0,0),
        arVector2(1,0),
        arVector2(1,1),
        arVector2(0,1)])
i.set([0,1,2,3])
d.set(("quads", 1))
e = ezview()
e.draw(g,c)
time.sleep(5)
</pre>

<img src="images/TexturedQuadWindow.jpg">

<a name="File">
<p><font size=+2>Scene Graph: Saving and Reloading Your Work</font>
</a>

<p>You should be certain that your Phleet parameters are set as in 
<a href="#Database">this</a> section, especially the SZG_PEER/path. We
assume you have worked through the section on <a href="#Objects">loading</a>
objects.

<p>First, save your database. You are writing it in binary format (which is
faster to load). Note the file type: .szg.

<pre>
  peer.writeDatabase("test-al.szg")
</pre>

A file "test-al.szg" should now be in the directory given by SZG_PEER/path on
the computer you are running the Python prompt. Next, quit the Python prompt
and exit from the reality peer workspace that was displaying your work.

<p>You will now get back to the point where you were before. Restart the
workspace, as before ("szg-rp work1"). Enter a new Python prompt.

<p>To load your previously saved scene:

<pre>
  peer.readDatabase("test-al.szg")
</pre>

Again, if this suceeds, it will output "1". Note that this does not look
exactly the same as it did before. The difference is the translation of the
peer "target" within the workspace "work1". To restore:

<hr>
</body>
</html>
